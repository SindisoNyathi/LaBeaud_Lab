{
    "collab_server" : "",
    "contents" : "# packages -----------------------------------------------------------------\n#install.packages(c(\"REDCapR\", \"mlr\"))\n#install.packages(c(\"dummies\"))\nlibrary(dplyr)\nlibrary(plyr)\nlibrary(redcapAPI)\nlibrary(REDCapR)\nlibrary(ggplot2)\n# get data -----------------------------------------------------------------\nsetwd(\"C:/Users/amykr/Box Sync/Amy Krystosik's Files/Data Managment/redcap/ro1 lab results long\")\nRedcap.token <- readLines(\"Redcap.token.R01.txt\") # Read API token from folder\nREDcap.URL  <- 'https://redcap.stanford.edu/api/'\n#R01_lab_results <- redcap_read(redcap_uri  = REDcap.URL, token = Redcap.token, batch_size = 300)$data#export data from redcap to R (must be connected via cisco VPN)\nlibrary(beepr)\nbeep(sound=4)\n\nwrite.csv(\"R01_lab_results\",\"R01_lab_results.csv\")\ncurrentDate <- Sys.Date() \nFileName <- paste(\"R01_lab_results\",currentDate,\".rda\",sep=\" \") \nsave(R01_lab_results,file=FileName)\n#load(FileName)\nR01_lab_results<- R01_lab_results[which(!is.na(R01_lab_results$redcap_event_name))  , ]\nR01_lab_results<- R01_lab_results[which(R01_lab_results$redcap_event_name!=\"visit_a2_arm_1\"&R01_lab_results$redcap_event_name!=\"visit_b2_arm_1\"&R01_lab_results$redcap_event_name!=\"visit_c2_arm_1\"&R01_lab_results$redcap_event_name!=\"visit_d2_arm_1\"&R01_lab_results$redcap_event_name!=\"visit_c2_arm_1\"&R01_lab_results$redcap_event_name!=\"visit_u24_arm_1\")  , ]\n\n# query specific id/value -------------------------------------------------\n#names for u24\nR01_lab_results[R01_lab_results$person_id==\"CF0175\" , c(\"village_aic\", \"child_first_name\", \"child_second_name\",\"child_third_name\",\"child_fourth_name\",\"child_surname\",\"phone_number_aic\",\"mother_first_name\",\"mother_second_name\",\"mother_third_name\",\"mother_fourth_name\",\"mother_surname\",\"father_first_name\",\"father_second_name\",\"father_third_name\",\"father_fourth_name\",\"father_surname\")]\n#microscopy results for melisa  \nR01_lab_results[R01_lab_results$person_id==\"CF0175\" , c(\"redcap_event_name\",\"result_microscopy_malaria_kenya\",\"density_microscpy_pf_kenya\",\"interview_date_aic\",\"rdt_results\",\"temp\",\"aic_symptom_fever\",\"result_igg_denv_kenya\",\"interviewer_name_aic\")]\n#aic form for david\nR01_lab_results[R01_lab_results$person_id==\"CF0175\" , c(\"redcap_event_name\",\"result_microscopy_malaria_kenya\",\"density_microscpy_pf_kenya\",\"interview_date_aic\",\"rdt_results\",\"result_igg_denv_kenya\",\"interviewer_name_aic\",\"date_tested_igg_denv_kenya\",\"date_tested_igg_chikv_kenya\")]\nR01_lab_results$date_tested_igg_chikv_kenya\n\ntable(R01_lab_results$outcome, R01_lab_results$outcome_hospitalized, R01_lab_results$outcome_where_hospitalized)\n\n\n# parse the id -----------------------------------------------------------------\nR01_lab_results$id_cohort<-substr(R01_lab_results$person_id, 2, 2)\nR01_lab_results$id_city<-substr(R01_lab_results$person_id, 1, 1)\n\nn_distinct(R01_lab_results$person_id)\ntable(R01_lab_results$id_cohort, R01_lab_results$redcap_event_name)\n\nR01_lab_results$id_visit<-as.integer(factor(R01_lab_results$redcap_event_name))\nR01_lab_results$id_visit<-R01_lab_results$id_visit-1\n\n\n# sites, city, rural ------------------------------------------------------\n\n#site\nR01_lab_results$id_city<-substr(R01_lab_results$person_id, 1, 1)\nR01_lab_results$site<-NA\ntable(R01_lab_results$id_city)\nR01_lab_results <- within(R01_lab_results, site[R01_lab_results$id_city==\"G\"] <- \"C\")\nR01_lab_results <- within(R01_lab_results, site[R01_lab_results$id_city==\"U\"] <- \"C\")\nR01_lab_results <- within(R01_lab_results, site[R01_lab_results$id_city==\"L\"] <- \"C\")\nR01_lab_results <- within(R01_lab_results, site[R01_lab_results$id_city==\"M\"] <- \"C\")\n\nR01_lab_results <- within(R01_lab_results, site[R01_lab_results$id_city==\"C\"] <- \"W\")\nR01_lab_results <- within(R01_lab_results, site[R01_lab_results$id_city==\"R\"] <- \"W\")\nR01_lab_results <- within(R01_lab_results, site[R01_lab_results$id_city==\"K\"] <- \"W\")\n\n\nR01_lab_results <- within(R01_lab_results, id_city[R01_lab_results$id_city==\"G\"] <- \"M\")\nR01_lab_results <- within(R01_lab_results, id_city[R01_lab_results$id_city==\"L\"] <- \"M\")\n\nR01_lab_results <- within(R01_lab_results, id_city[R01_lab_results$id_city==\"R\"] <- \"C\")\nR01_lab_results <- within(R01_lab_results, id_city[R01_lab_results$id_city==\"O\"] <- NA)\ntable(R01_lab_results$id_city)\n##rural\nR01_lab_results$rural<-NA\nR01_lab_results <- within(R01_lab_results, rural[R01_lab_results$id_city==\"G\"] <- 1)\nR01_lab_results <- within(R01_lab_results, rural[R01_lab_results$id_city==\"U\"] <- 0)\nR01_lab_results <- within(R01_lab_results, rural[R01_lab_results$id_city==\"L\"] <- 1)\nR01_lab_results <- within(R01_lab_results, rural[R01_lab_results$id_city==\"M\"] <- 1)\n\nR01_lab_results <- within(R01_lab_results, rural[R01_lab_results$id_city==\"C\"] <- 1)\nR01_lab_results <- within(R01_lab_results, rural[R01_lab_results$id_city==\"R\"] <- 1)\nR01_lab_results <- within(R01_lab_results, rural[R01_lab_results$id_city==\"K\"] <- 0)\n\n#cohort\nR01_lab_results <- within(R01_lab_results, id_cohort[R01_lab_results$id_cohort==\"M\"] <- \"F\")\n\ntable(R01_lab_results$rural, exclude = NULL)\ntable(R01_lab_results$site, exclude = NULL)\n\n# interview dates ---------------------------------------------------------\nlibrary(\"zoo\")\nlibrary(\"lubridate\")\nlibrary(tidyr)\n#    load(\"R01_lab_results.rda\")\nR01_lab_results_visit<- R01_lab_results[which(R01_lab_results$redcap_event_name!=\"patient_informatio_arm_1\"&R01_lab_results$redcap_event_name!=\"visit_u24_arm_1\")  , ]\nsetwd(\"C:/Users/amykr/Box Sync/Amy Krystosik's Files/Data Managment/redcap/ro1 lab results long\")\nforsaidi<- R01_lab_results[which(!is.na(R01_lab_results$interview_date_aic) & (is.na(R01_lab_results$result_microscopy_malaria_kenya)) & (!is.na(R01_lab_results$result_igg_denv_kenya))),]\nforsaidi<-forsaidi[,c(\"person_id\",\"id_city\",\"redcap_event_name\",\"interview_date_aic\",\"result_microscopy_malaria_kenya\",\"result_igg_denv_kenya\",\"malaria_results\",\"rdt_results\",\"aic_symptom_fever\",\"temp\")]\nwrite.csv(forsaidi,\"missing_microscopy.csv\",na=\"\")\n\ninterview_dates<-R01_lab_results_visit[, grepl(\"person_id|redcap_event_name|interview_date|id_city|redcap_event_name|id_cohort\", names(R01_lab_results_visit))]\ninterview_dates<-interview_dates[, !grepl(\"u24\", names(interview_dates))]\ninterview_dates[is.na(interview_dates)] = ''\ninterview_dates<-unite(interview_dates, int_date, interview_date_aic:interview_date, sep='')\nR01_lab_results<- merge(interview_dates, R01_lab_results,  by=c(\"person_id\", \"redcap_event_name\", \"id_city\", \"id_cohort\"), all = TRUE)\n\n#send samples without interview dates to cornleius. \nR01_lab_results_no_date<- R01_lab_results\nR01_lab_results_no_date<-R01_lab_results_no_date[, grepl(\"person_id|redcap_event_name|interview_date|int_date|id_city|redcap_event_name|id_cohort\", names(R01_lab_results_no_date))]\nR01_lab_results_no_date<-R01_lab_results_no_date[, !grepl(\"u24\", names(R01_lab_results_no_date))]\nR01_lab_results_no_date[R01_lab_results_no_date==\"\"]<-NA\n#    write.csv(as.data.frame(R01_lab_results_no_date), \"R01_lab_results_no_date.csv\", row.names = F )\n\n\n#dates\nclass(R01_lab_results$int_date)\nR01_lab_results$int_date <-ymd(R01_lab_results$int_date)\nn_distinct(R01_lab_results$int_date)\n\nR01_lab_results$month_year <- as.yearmon(R01_lab_results$int_date)\n\nR01_lab_results$year <- year(as.Date(R01_lab_results$int_date, origin = '1900-1-1'))\n\n\n# create binary symptom vars -----------------------------------------------------------------\n#subset symptoms\nsymptoms<-R01_lab_results[which(R01_lab_results$id_visit > 0), c(\"person_id\", \"redcap_event_name\",\"symptoms\", \"symptoms_aic\", \"id_cohort\", \"id_city\", \"id_visit\", \"visit_type\")]\nsymptoms<-as.data.frame(symptoms)\nsymptoms$all_symptoms<-paste(symptoms$symptoms, symptoms$symptoms_aic , sep=\" \")\nsymptoms <- lapply(symptoms, function(x) {\n  gsub(\",NA\", \"\", x)\n})\nsymptoms <- lapply(symptoms, function(x) {\n  gsub(\"NA\", \"\", x)\n})\nsymptoms <- lapply(symptoms, function(x) {\n  gsub(\",none\", \"\", x)\n})\nsymptoms <- lapply(symptoms, function(x) {\n  gsub(\"none\", \"\", x)\n})\nsymptoms<-as.data.frame(symptoms)\n\n\n#create dummy vars for all symptoms\nsymptoms<-as.data.frame(symptoms)\nsymptoms$all_symptoms<-tolower(symptoms$all_symptoms)\n\nsymptoms$all_symptoms <- gsub('abdomil_pain', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abdominal_pa', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abdomin', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abdomina', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abdominal_pai', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abdominal_p', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abdo', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abd', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abpin', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abpi', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abpal_p', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abpa', 'abp', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('abp', 'abdominal_pain', symptoms$all_symptoms)\n\nsymptoms$all_symptoms <- gsub('chiils', 'chills', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('diarrh', 'diarrhea', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('diarrheaea', 'diarrhea', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('usea', 'nausea', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('nanausea', 'nausea', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('ras', 'rash', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('rashh', 'rash', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('99', '', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub('none', '', symptoms$all_symptoms)\nsymptoms$all_symptoms <- gsub(\"\\\\<a\\\\>\", '', symptoms$all_symptoms)\n\n#symptoms <-symptoms[!(is.na(symptoms$all_symptoms) | symptoms$all_symptoms==\" \"), ]\nlev <- levels(factor(symptoms$all_symptoms))\nlev <- unique(unlist(strsplit(lev, \" \")))\nmnames <- gsub(\" \", \"_\", paste(\"aic_symptom\", lev, sep = \"_\"))\nresult <- matrix(data = \"0\", nrow = length(symptoms$all_symptoms), ncol = length(lev))\nchar.aic_symptom <- as.character(symptoms$all_symptoms)\nfor (i in 1:length(lev)) {\n  result[grep(lev[i], char.aic_symptom, fixed = TRUE), i] <- \"1\"\n}\nresult <- data.frame(result, stringsAsFactors = TRUE)\ncolnames(result) <- mnames\nsymptoms <- cbind(symptoms,result)\n\nas.numeric.factor <- function(x) {as.numeric(levels(x))[x]}\nids <- c(\"person_id\", \"redcap_event_name\", \"all_symptoms\")\nids <- symptoms[ids]\nsymptoms<-symptoms[ , !(names(symptoms) %in% \"aic_symptom_\")]\naic_symptom_<-grep(\"aic_symptom_\", names(symptoms), value = TRUE)\nsymptoms<-symptoms[ , (names(symptoms) %in% aic_symptom_)]\nsymptoms <-as.data.frame(sapply(symptoms, as.numeric.factor))\n\n#collapse the symptoms that are the same.\nsymptoms <- within(symptoms, aic_symptom_impaired_mental_status[symptoms$aic_symptom_fits==0|symptoms$aic_symptom_seizures==0] <- 0)\nsymptoms <- within(symptoms, aic_symptom_impaired_mental_status[symptoms$aic_symptom_fits==1|symptoms$aic_symptom_seizures==1] <- 1)\n\nsymptoms$bleeding<-NA\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bleeding_gums==0] <- 0)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bleeding_gums==0] <- 0)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bloody_nose==0] <- 0)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bloody_urine==0] <- 0)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bloody_stool==0] <- 0)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bloody_vomit==0] <- 0)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bruises==0] <- 0)\n\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bleeding_gums==1] <- 1)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bleeding_gums==1] <- 1)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bloody_nose==1] <- 1)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bloody_urine==1] <- 1)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bloody_stool==1] <- 1)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bloody_vomit==1] <- 1)\nsymptoms <- within(symptoms, bleeding[symptoms$aic_symptom_bruises==1] <- 1)\n\nsymptoms$body_ache<-NA\nsymptoms <- within(symptoms, body_ache[symptoms$aic_symptom_general_body_ache==0] <- 0)\nsymptoms <- within(symptoms, body_ache[symptoms$aic_symptom_muscle_pains==0] <- 0)\nsymptoms <- within(symptoms, body_ache[symptoms$aic_symptom_bone_pains==0] <- 0)\n\nsymptoms <- within(symptoms, body_ache[symptoms$aic_symptom_general_body_ache==1] <- 1)\nsymptoms <- within(symptoms, body_ache[symptoms$aic_symptom_muscle_pains==1] <- 1)\nsymptoms <- within(symptoms, body_ache[symptoms$aic_symptom_bone_pains==1] <- 1)\ntable(symptoms$body_ache)\nvariable.names(symptoms)\n\nsymptoms$nausea_vomitting<-NA\nsymptoms <- within(symptoms, nausea_vomitting[symptoms$aic_symptom_nausea==0|symptoms$aic_symptom_vomiting==0| symptoms$aic_symptom_bloody_vomit==0] <- 0)\nsymptoms <- within(symptoms, nausea_vomitting[symptoms$aic_symptom_nausea==1|symptoms$aic_symptom_vomiting==1| symptoms$aic_symptom_bloody_vomit==1] <- 1)\n\nsymptoms<-symptoms[ , grepl( \"aic_symptom|bleeding|body_ache|nausea_vomitting\" , names(symptoms) ) ]\nsymptoms$symptom_sum <- as.integer(rowSums(symptoms[ , grep(\"aic_symptom\" , names(symptoms))], na.rm = TRUE))\ntable(symptoms$symptom_sum, exclude=NULL)\nsymptoms$symptomatic<-NA\nsymptoms <- within(symptoms, symptomatic[symptoms$symptom_sum>0] <- 1)\nsymptoms <- within(symptoms, symptomatic[symptoms$symptom_sum==0] <- 0)\n\n#how much of our acute DENV was symptomatic vs. mildly/asymptomatic, etc.\ntable(symptoms$symptomatic, exclude=NULL)\n#export to box.\nsymptoms<-as.data.frame(cbind(ids, symptoms))\nsymptoms$id_cohort<-substr(symptoms$person_id, 2, 2)\naic_symptoms<-subset(symptoms, id_cohort!=\"C\")\naic_symptoms<-aic_symptoms[, !grepl(\"id_cohort\", names(aic_symptoms))]\n\n# create binary physical vars -----------------------------------------------------------------\n#parce the physical exam results-----------------------------------------------------------------\n#subset physical_exam\nphysical_exam<-R01_lab_results[which(R01_lab_results$redcap_event_name!=\"patient_informatio_arm_1\"), c(\"person_id\", \"redcap_event_name\",\"head_neck_exam\", \"skin\", \"neuro\", \"abdomen\", \"chest\", \"heart\", \"nodes\", \"joints\")]\nphysical_exam<-as.data.frame(physical_exam)    \nphysical_exam$all_exam<-paste(physical_exam$head_neck_exam, physical_exam$skin, physical_exam$neuro, physical_exam$abdomen, physical_exam$joints, physical_exam$nodes, physical_exam$heart, physical_exam$chest, physical_exam$abdomen, sep=\" \")\nphysical_exam <- lapply(physical_exam, function(x) {\n  gsub(\",NA\", \"\", x)\n})\nphysical_exam <- lapply(physical_exam, function(x) {\n  gsub(\"NA\", \"\", x)\n})\nphysical_exam <- lapply(physical_exam, function(x) {\n  gsub(\",none\", \"\", x)\n})\nphysical_exam <- lapply(physical_exam, function(x) {\n  gsub(\"none\", \"\", x)\n})\nphysical_exam<-as.data.frame(physical_exam)\n\n#create dummy vars for all physical_exam\nlev <- levels(factor(physical_exam$all_exam))\nlev <- unique(unlist(strsplit(lev, \" \")))\nmnames <- gsub(\" \", \"_\", paste(\"aic_pe\", lev, sep = \"_\"))\nresult <- matrix(data = \"0\", nrow = length(physical_exam$all_exam), ncol = length(lev))\nchar.aic_pe <- as.character(physical_exam$all_exam)\nfor (i in 1:length(lev)) {\n  result[grep(lev[i], char.aic_pe, fixed = TRUE), i] <- \"1\"\n}\nresult <- data.frame(result, stringsAsFactors = TRUE)\ncolnames(result) <- mnames\nphysical_exam <- cbind(physical_exam,result)\n\nas.numeric.factor <- function(x) {as.numeric(levels(x))[x]}\nids <- c(\"person_id\", \"redcap_event_name\", \"all_exam\")\nids <- physical_exam[ids]\nphysical_exam<-physical_exam[ , !(names(physical_exam) %in% \"aic_pe_\")]\naic_pe<-grep(\"aic_pe_\", names(physical_exam), value = TRUE)\nphysical_exam<-physical_exam[ , (names(physical_exam) %in% aic_pe)]\nphysical_exam <-as.data.frame(sapply(physical_exam, as.numeric.factor))\n\n#create binary var for nodes      \nphysical_exam$node<-NA\ntable(physical_exam$aic_pe_large_lymph_nodes)\n\nphysical_exam<-as.data.frame(cbind(ids, physical_exam))\n\n# reshape testing vars -----------------------------------------------------------------\n#tested\ntested<-R01_lab_results[, grepl(\"person_id|redcap_event|tested_\", names(R01_lab_results))]\ntested<-tested[, !grepl(\"date\", names(tested))]\n\ntested<-tested[which(tested$redcap_event_name==\"patient_informatio_arm_1\"),]\ncolnames(tested)<-sub(\"tested_*\",\"\", colnames(tested))    \ncolnames(tested)<-sub(\"*_2\",\"\", colnames(tested))    \n#order\ntested<-tested[,order(colnames(tested))]\n\ntested<-tested[order(-(grepl('gh_$', names(tested)))+1L)]\ntested<-tested[order(-(grepl('fg_$', names(tested)))+1L)]\ntested<-tested[order(-(grepl('ef_$', names(tested)))+1L)]\ntested<-tested[order(-(grepl('de_$', names(tested)))+1L)]\ntested<-tested[order(-(grepl('cd_$', names(tested)))+1L)]\ntested<-tested[order(-(grepl('bc_$', names(tested)))+1L)]\ntested<-tested[order(-(grepl('ab_$', names(tested)))+1L)]\n\nnameVec <- names(tested)\nv.names=c('chikv_kenya_igg', 'chikv_stfd_igg', 'denv_kenya_igg', 'denv_stfd_igg')\ntimes = c(\"ab_\", \"bc_\", \"cd_\", \"de_\", \"ef_\", \"fg_\", \"gh_\")    \ntested_long<-reshape(tested, idvar = \"person_id\", varying = 1:28,  direction = \"long\", timevar = \"visit\", times=times, v.names=v.names)\ntable(tested$ab_chikv_stfd_igg)\ntable(tested$bc_chikv_stfd_igg)\ntable(tested_long$chikv_stfd_igg, tested_long$visit)\n\n\ntested_long <- within(tested_long, visit[visit==\"ab_\"] <- \"visit_a_arm_1\")\ntested_long <- within(tested_long, visit[visit==\"bc_\"] <- \"visit_b_arm_1\")\ntested_long <- within(tested_long, visit[visit==\"cd_\"] <- \"visit_c_arm_1\")\ntested_long <- within(tested_long, visit[visit==\"de_\"] <- \"visit_d_arm_1\")\ntested_long <- within(tested_long, visit[visit==\"ef_\"] <- \"visit_e_arm_1\")\ntested_long <- within(tested_long, visit[visit==\"fg_\"] <- \"visit_f_arm_1\")\ntested_long <- within(tested_long, visit[visit==\"gh_\"] <- \"visit_g_arm_1\")\ntested_long$redcap_event_name<-tested_long$visit\nnames(tested_long)[names(tested_long) == 'denv_kenya_igg'] <- 'tested_denv_kenya_igg'\nnames(tested_long)[names(tested_long) == 'chikv_kenya_igg'] <- 'tested_chikv_kenya_igg'\nnames(tested_long)[names(tested_long) == 'denv_stfd_igg'] <- 'tested_denv_stfd_igg'\nnames(tested_long)[names(tested_long) == 'chikv_stfd_igg'] <- 'tested_chikv_stfd_igg'\n\nhead(tested_long)\n# reshape sereoconverter vars -----------------------------------------------------------------\n#seroconversion\nseroconverter<-R01_lab_results[, grepl(\"person_id|redcap_event|ab_|bc_|cd_|de_|ef_|fg_|gh_\", names(R01_lab_results))]\nseroconverter<-seroconverter[, !grepl(\"malaria|tested\", names(seroconverter))]\nseroconverter<-seroconverter[which(seroconverter$redcap_event_name==\"patient_informatio_arm_1\"),]\n\n#order\nseroconverter<-seroconverter[,order(colnames(seroconverter))]\n\nseroconverter<-seroconverter[order(-(grepl('gh_$', names(seroconverter)))+1L)]\nseroconverter<-seroconverter[order(-(grepl('fg_$', names(seroconverter)))+1L)]\nseroconverter<-seroconverter[order(-(grepl('ef_$', names(seroconverter)))+1L)]\nseroconverter<-seroconverter[order(-(grepl('de_$', names(seroconverter)))+1L)]\nseroconverter<-seroconverter[order(-(grepl('cd_$', names(seroconverter)))+1L)]\nseroconverter<-seroconverter[order(-(grepl('bc_$', names(seroconverter)))+1L)]\nseroconverter<-seroconverter[order(-(grepl('ab_$', names(seroconverter)))+1L)]\n\nnameVec <- names(seroconverter)\nv.names=c('chikv_kenya_igg', 'chikv_stfd_igg', 'denv_kenya_igg', 'denv_stfd_igg')\ntimes = c(\"ab_\", \"bc_\", \"cd_\", \"de_\", \"ef_\", \"fg_\", \"gh_\")    \nseroconverter_long<-reshape(seroconverter, idvar = \"person_id\", varying = 1:28,  direction = \"long\", timevar = \"visit\", times=times, v.names=v.names)\n\ntable(seroconverter$ab_chikv_stfd_igg)\ntable(seroconverter$ab_denv_stfd_igg)\ntable(seroconverter$bc_chikv_stfd_igg)\ntable(seroconverter$bc_denv_stfd_igg)\ntable(seroconverter_long$chikv_stfd_igg, seroconverter_long$visit)\ntable(seroconverter_long$denv_stfd_igg, seroconverter_long$visit)\n\nseroconverter_long <- within(seroconverter_long, visit[visit==\"ab_\"] <- \"visit_a_arm_1\")\nseroconverter_long <- within(seroconverter_long, visit[visit==\"bc_\"] <- \"visit_b_arm_1\")\nseroconverter_long <- within(seroconverter_long, visit[visit==\"cd_\"] <- \"visit_c_arm_1\")\nseroconverter_long <- within(seroconverter_long, visit[visit==\"de_\"] <- \"visit_d_arm_1\")\nseroconverter_long <- within(seroconverter_long, visit[visit==\"ef_\"] <- \"visit_e_arm_1\")\nseroconverter_long <- within(seroconverter_long, visit[visit==\"fg_\"] <- \"visit_f_arm_1\")\nseroconverter_long <- within(seroconverter_long, visit[visit==\"gh_\"] <- \"visit_g_arm_1\")\nseroconverter_long$redcap_event_name<-seroconverter_long$visit\nnames(seroconverter_long)[names(seroconverter_long) == 'denv_kenya_igg'] <- 'seroc_denv_kenya_igg'\nnames(seroconverter_long)[names(seroconverter_long) == 'chikv_kenya_igg'] <- 'seroc_chikv_kenya_igg'\nnames(seroconverter_long)[names(seroconverter_long) == 'denv_stfd_igg'] <- 'seroc_denv_stfd_igg'\nnames(seroconverter_long)[names(seroconverter_long) == 'chikv_stfd_igg'] <- 'seroc_chikv_stfd_igg'\n\nsave(aic_symptoms,file=\"aic_symptoms.rda\")\n# merging the created data sets back to main -----------------------------------------------------------------\nR01_lab_results <- merge(seroconverter_long, R01_lab_results,  by=c(\"person_id\", \"redcap_event_name\"), all = TRUE)  #merge symptoms to redcap data\nR01_lab_results <- merge(aic_symptoms, R01_lab_results, by=c(\"person_id\", \"redcap_event_name\"), all = TRUE)  #merge symptoms to redcap data\nR01_lab_results <- merge(physical_exam, R01_lab_results,  by=c(\"person_id\", \"redcap_event_name\"), all = TRUE)  #merge pe parsed data\nR01_lab_results <- merge(tested_long, R01_lab_results,  by=c(\"person_id\", \"redcap_event_name\"), all = TRUE)  #merge tested samples \n# dengue : probable and warning -----------------------------------------------------------------\nR01_lab_results$probable_dengue<-rowSums(R01_lab_results[, grep(\"/body_ache|aic_symptom_vomitfg|aic_symptom_nausea|bleeding|impaired_mental_status|hepatomegaly|rash\", names(R01_lab_results))], na.rm = TRUE)    #probable dengue\nR01_lab_results$dengue_warning_signs<-rowSums(R01_lab_results[, grep(\"aic_symptom_impaired_mental_status|bleeding|aic_symptom_vomiting|aic_symptom_abdominal_pain|hepatomegaly|splenomegaly|edema\", names(R01_lab_results))], na.rm = TRUE)#warning signs (dengue)\nR01_lab_results$dengue_warning<-ifelse(R01_lab_results$probable_dengue >= 2 & R01_lab_results$dengue_warning_signs >0 , 1, 0)#dengue with warning signs   \ntable(R01_lab_results$dengue_warning_signs, R01_lab_results$probable_dengue)\n# PCR -----------------------------------------------------------------\n#PCR DENV or chikv\nR01_lab_results$denv_chikv_result_pcr[R01_lab_results$result_pcr_denv_kenya == 0|R01_lab_results$result_pcr_denv_stfd == 0|R01_lab_results$result_pcr_chikv_kenya == 0|R01_lab_results$result_pcr_chikv_stfd == 0] <- 0\nR01_lab_results$denv_chikv_result_pcr[R01_lab_results$result_pcr_denv_kenya == 1|R01_lab_results$result_pcr_denv_stfd == 1|R01_lab_results$result_pcr_chikv_kenya == 1|R01_lab_results$result_pcr_chikv_stfd == 1] <- 1\ntable(R01_lab_results$denv_chikv_result_pcr)\n125/(2415)*100\n\n# UFI -----------------------------------------------------------------\n#UFI CHIKV\ntable(R01_lab_results$chikv_result_ufi)\n#UFI DENV\ntable(R01_lab_results$denv_result_ufi)\n#UFI DENV AND chikv\ntable(R01_lab_results$denv_result_ufi, R01_lab_results$chikv_result_ufi, exclude = NULL)\n\n#UFI DENV or chikv\nR01_lab_results$denv_chikv_result_ufi[R01_lab_results$denv_result_ufi == 0|R01_lab_results$chikv_result_ufi==0] <- 0\nR01_lab_results$denv_chikv_result_ufi[R01_lab_results$denv_result_ufi == 1|R01_lab_results$denv_result_ufi==1] <- 1\ntable(R01_lab_results$denv_chikv_result_ufi)\n38/(38+454)*100\n\n# acute -----------------------------------------------------------------\n#create acute variable\ntable(R01_lab_results$acute)\nR01_lab_results$acute<-NA\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$visit_type==1] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$visit_type==2] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$visit_type==3] <- 0)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$visit_type==4] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$visit_type==5] <- 1)\n#if they ask an initial survey question (see odk aic inital and follow up forms), it is an initial visit.\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$kid_highest_level_education_aic!=\"\"] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$occupation_aic!=\"\"] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$oth_educ_level_aic!=\"\"] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$mom_highest_level_education_aic!=\"\"] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$roof_type!=\"\"] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$pregnant!=\"\"] <- 1)\n#if it is visit a,call it acute\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$redcap_event==\"visit_a_arm_1\" & id_cohort==\"F\"] <- 1)\n#if they have fever, call it acute\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$aic_symptom_fever==1] <- 1)\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$temp>=38] <- 1)\n#otherwise, it is not acute\nR01_lab_results <- within(R01_lab_results, acute[R01_lab_results$acute!=1 & !is.na(R01_lab_results$gender_aic) ] <- 0)\n\ntable(R01_lab_results$acute)\n\n##age group---------------------------------------------------\nR01_lab_results$age = R01_lab_results$age_calc_rc  # your new merged column starts with age_calc_rc\nR01_lab_results$age[!is.na(R01_lab_results$aic_calculated_age)] = R01_lab_results$aic_calculated_age[!is.na(R01_lab_results$aic_calculated_age)]  # merge with aic_calculated_age\nR01_lab_results$age[!is.na(R01_lab_results$age_calc)] = R01_lab_results$age_calc[!is.na(R01_lab_results$age_calc)]  # merge with age_calc\n\nR01_lab_results$age<-round(R01_lab_results$age)\n\nsummary(R01_lab_results$age)\nR01_lab_results$age_group<-NA\nR01_lab_results <- within(R01_lab_results, age_group[age<=2] <- \"under 2\")\nR01_lab_results <- within(R01_lab_results, age_group[age>2 & age<=5] <- \"2-5\")\nR01_lab_results <- within(R01_lab_results, age_group[age>5 & age<=10] <- \"6-10\")\nR01_lab_results <- within(R01_lab_results, age_group[age>10 & age<=15] <- \"11-15\")\nR01_lab_results <- within(R01_lab_results, age_group[age>15] <- \"over 15\")\nR01_lab_results$age_group <- factor(R01_lab_results$age_group, levels = c(\"under 2\", \"2-5\", \"6-10\", \"11-15\", \"over 15\"))\ntable(R01_lab_results$age_group, exclude = NULL)\n\n# deidentify -----------------------------------------------------------------\n#take name out of event.\n#names(R01_lab_results)[names(R01_lab_results) == 'redcap_event_name'] <- 'redcap_event'\n#identifiers<-grep(\"name|gps\", names(R01_lab_results), value = TRUE)\n#R01_lab_results<-R01_lab_results[ , !(names(R01_lab_results) %in% identifiers)]#turn of the deidentifiers to export the u24 data. \n#names(R01_lab_results)[names(R01_lab_results) == 'redcap_event'] <- 'redcap_event_name'\n\n# incidence -----------------------------------------------------------------\ntable(R01_lab_results$seroc_denv_kenya_igg, R01_lab_results$seroc_denv_stfd_igg, exclude=NULL)\n\nR01_lab_results$id_cohort<-substr(R01_lab_results$person_id, 2, 2)\nR01_lab_results$id_city<-substr(R01_lab_results$person_id, 1, 1)\n#use tested = 1 as the zero for infection.\n#kenya denv igg seroconverters or PCR positives as infected.\nR01_lab_results$infected_denv_kenya[R01_lab_results$tested_denv_kenya_igg ==1 | R01_lab_results$result_pcr_denv_kenya==0|R01_lab_results$result_pcr_denv_stfd==0|R01_lab_results$denv_result_ufi==0]<-0\nR01_lab_results$infected_denv_kenya[R01_lab_results$seroc_denv_kenya_igg==1|R01_lab_results$result_pcr_denv_kenya==1|R01_lab_results$result_pcr_denv_stfd==1|R01_lab_results$denv_result_ufi==1]<-1\ntable(R01_lab_results$infected_denv_kenya, R01_lab_results$denv_result_ufi)\n\ntable(R01_lab_results$result_pcr_denv_kenya)  \ntable(R01_lab_results$denv_result_ufi)  \n#kenya chikv igg seroconverters or PCR positives as infected.\nR01_lab_results$infected_chikv_kenya[R01_lab_results$tested_chikv_kenya_igg ==1 |R01_lab_results$result_pcr_chikv_kenya==0|R01_lab_results$chikv_result_ufi]<-0\nR01_lab_results$infected_chikv_kenya[R01_lab_results$seroc_chikv_kenya_igg==1|R01_lab_results$result_pcr_chikv_kenya==1|R01_lab_results$chikv_result_ufi==1]<-1\ntable(R01_lab_results$infected_chikv_kenya)  \n\n#stfd denv igg seroconverters or PCR positives as infected.\nR01_lab_results$infected_denv_stfd<-NA\nR01_lab_results$infected_denv_stfd[R01_lab_results$tested_denv_stfd_igg ==1 |R01_lab_results$result_pcr_denv_kenya==0|R01_lab_results$result_pcr_denv_stfd==0|R01_lab_results$denv_result_ufi==0]<-0\nR01_lab_results$infected_denv_stfd[R01_lab_results$seroc_denv_stfd_igg==1|R01_lab_results$result_pcr_denv_kenya==1|R01_lab_results$result_pcr_denv_stfd==1|R01_lab_results$denv_result_ufi==1]<-1\ntable(R01_lab_results$infected_denv_stfd)  \n174/(4073)*100\n\ntable(R01_lab_results$infected_denv_stfd, R01_lab_results$redcap_event_name)  \ntable(R01_lab_results$infected_denv_stfd, R01_lab_results$id_cohort)\ntable(R01_lab_results$tested_denv_stfd_igg, R01_lab_results$id_cohort)\n172/(172 + 3216)*100#aic inc\ntable(R01_lab_results$seroc_denv_stfd_igg, R01_lab_results$id_cohort)  \ntable(R01_lab_results$tested_denv_stfd_igg, R01_lab_results$id_cohort)  \n2/685*100 #hcc seroconverters\n\n#prnt\nR01_lab_results <- within(R01_lab_results, prnt_80_chikv[R01_lab_results$prnt_80_chikv ==\"<10\"] <- \"5\")\nR01_lab_results <- within(R01_lab_results, prnt_80_wnv[R01_lab_results$prnt_80_wnv ==\">80\"] <- \"160\")\nR01_lab_results <- within(R01_lab_results, prnt_80_wnv[R01_lab_results$prnt_80_wnv ==\"No sample\"] <- NA)\nR01_lab_results <- within(R01_lab_results, prnt_80_denv[R01_lab_results$prnt_80_denv ==\"<10\"] <- \"5\")\nR01_lab_results <- within(R01_lab_results, prnt_80_denv[R01_lab_results$prnt_80_denv ==\"nd\"] <- \"NA\")\nR01_lab_results <- within(R01_lab_results, prnt_80_wnv[R01_lab_results$prnt_80_wnv ==\"<10\"] <- \"5\")\nR01_lab_results <- within(R01_lab_results, prnt_80_onn[R01_lab_results$prnt_80_onn ==\">80\"] <- \"160\")\nR01_lab_results <- within(R01_lab_results, prnt_80_onn[R01_lab_results$prnt_80_onn ==\"<10\"] <- \"5\")\nR01_lab_results <- within(R01_lab_results, prnt_80_onn[R01_lab_results$prnt_80_onn ==\"No sample\"|R01_lab_results$prnt_80_onn ==\"no sample\"] <- NA)\nR01_lab_results$prnt_80_wnv<-as.numeric(as.character(R01_lab_results$prnt_80_wnv))\nclass(R01_lab_results$prnt_80_wnv)\ntable(R01_lab_results$prnt_80_wnv)\n\nR01_lab_results$prnt_80_onn<-as.numeric(as.character(R01_lab_results$prnt_80_onn))\nclass(R01_lab_results$prnt_80_onn)\ntable(R01_lab_results$prnt_80_wnv)\nR01_lab_results$prnt_result_onn<-NA\nR01_lab_results <- within(R01_lab_results, prnt_result_onn[R01_lab_results$prnt_80_onn <10] <- 0)\nR01_lab_results <- within(R01_lab_results, prnt_result_onn[R01_lab_results$prnt_80_onn >=10] <- 1)\ntable(R01_lab_results$prnt_result_onn)\n\nR01_lab_results$prnt_80_denv<-as.numeric(as.character(R01_lab_results$prnt_80_denv))\nclass(R01_lab_results$prnt_80_denv)\ntable(R01_lab_results$prnt_80_denv)\nR01_lab_results$prnt_result_denv<-NA\nR01_lab_results <- within(R01_lab_results, prnt_result_denv[R01_lab_results$prnt_80_denv <10] <- 0)\nR01_lab_results <- within(R01_lab_results, prnt_result_denv[R01_lab_results$prnt_80_denv >=10] <- 1)\ntable(R01_lab_results$prnt_result_denv, R01_lab_results$prnt_80_denv)\n\nR01_lab_results$prnt_80_chikv<-as.numeric(as.character(R01_lab_results$prnt_80_chikv))\nclass(R01_lab_results$prnt_80_chikv)\ntable(R01_lab_results$prnt_80_chikv)\nR01_lab_results$prnt_result_chikv<-NA\nR01_lab_results <- within(R01_lab_results, prnt_result_chikv[R01_lab_results$prnt_80_chikv <10] <- 0)\nR01_lab_results <- within(R01_lab_results, prnt_result_chikv[R01_lab_results$prnt_80_chikv >=10] <- 1)\ntable(R01_lab_results$prnt_result_chikv)\n\nR01_lab_results$prnt_80_wnv<-as.numeric(as.character(R01_lab_results$prnt_80_wnv))\nclass(R01_lab_results$prnt_80_wnv)\ntable(R01_lab_results$prnt_80_wnv)\nR01_lab_results$prnt_result_wnv<-NA\nR01_lab_results <- within(R01_lab_results, prnt_result_wnv[R01_lab_results$prnt_80_wnv <10] <- 0)\nR01_lab_results <- within(R01_lab_results, prnt_result_wnv[R01_lab_results$prnt_80_wnv >=10] <- 1)\ntable(R01_lab_results$prnt_result_wnv)\n\n\n#stfd chikv igg seroconverters or PCR positives as infected. or PNRT +\nR01_lab_results$infected_chikv_stfd[R01_lab_results$tested_chikv_stfd_igg ==1 |R01_lab_results$result_pcr_chikv_kenya==0|R01_lab_results$chikv_result_ufi==0]<-0\nR01_lab_results$infected_chikv_stfd[R01_lab_results$seroc_chikv_stfd_igg==1|R01_lab_results$result_pcr_chikv_kenya==1|R01_lab_results$chikv_result_ufi==1]<-1\ntable(R01_lab_results$infected_chikv_stfd)  \n119/(4151)*100\n\ntable(R01_lab_results$infected_chikv_stfd, R01_lab_results$id_cohort)  \n56/(56+3418)*100#aic inc\n\ntable(R01_lab_results$seroc_chikv_stfd_igg, R01_lab_results$id_cohort)  \ntable(R01_lab_results$tested_chikv_stfd_igg, R01_lab_results$id_cohort)  \n5/717*100 #hcc seroconverters\ntable(R01_lab_results$seroc_chikv_stfd_igg, R01_lab_results$site)  \n\n\n#chikv or denv incidence\nR01_lab_results$infected_denv_chikv_stfd[R01_lab_results$infected_chikv_stfd==0 |R01_lab_results$infected_denv_stfd==0]<-0\nR01_lab_results$infected_denv_chikv_stfd[R01_lab_results$infected_chikv_stfd==1 |R01_lab_results$infected_denv_stfd==1]<-1\ntable(R01_lab_results$infected_denv_chikv_stfd)\n222/(222 + 4536)*100\ntable(R01_lab_results$infected_denv_chikv_stfd, R01_lab_results$id_cohort)  \n8/(8 + 714)*100#hcc\n214/(214 + 3802)*100#aic\n\n\n##denominator is only those tested for chikv by pcr or igg at stfd ---------------------------------------------------\nR01_lab_results$tested_chikv<-NA\nR01_lab_results<- within(R01_lab_results, tested_chikv[infected_chikv_stfd==1 |tested_chikv_stfd_igg==1 | !is.na(result_pcr_chikv_kenya)| !is.na(result_pcr_chikv_stfd)| !is.na(chikv_result_ufi)] <- 1)\ntable(R01_lab_results$infected_chikv_stfd, exclude = NULL)\ntable(R01_lab_results$tested_chikv, exclude = NULL)\ntable(R01_lab_results$tested_chikv, R01_lab_results$infected_chikv_stfd, exclude = NULL)\n(19/3938)*100 #incidence chikv\n\n##denominator is only those tested for denv by pcr or igg at stfd---------------------------------------------------\nR01_lab_results$tested_denv<-NA\nR01_lab_results<- within(R01_lab_results, tested_denv[infected_denv_stfd==1 |tested_denv_stfd_igg==1 | !is.na(result_pcr_denv_kenya) | !is.na(result_pcr_denv_stfd)|!is.na(denv_result_ufi)] <- 1)\n#denominator is only those tested for denv or chikv by pcr or igg at stfd\nR01_lab_results$tested_denv_chikv<-NA\nR01_lab_results<- within(R01_lab_results, tested_denv_chikv[tested_chikv==1 |tested_denv==1] <- 1)\n\n# prevalence -----------------------------------------------------------------\nR01_lab_results_prev_denv<-R01_lab_results[which(R01_lab_results$infected_denv_stfd==1|R01_lab_results$result_igg_denv_stfd==1),]\nR01_lab_results_prev_denv <- R01_lab_results_prev_denv[order(R01_lab_results_prev_denv$person_id, R01_lab_results_prev_denv$int_date),]\nR01_lab_results_prev_denv <- R01_lab_results_prev_denv[!duplicated(R01_lab_results_prev_denv$person_id),]\nR01_lab_results_prev_denv$prev_denv_stfd<-\"1\"\nR01_lab_results_prev_denv<-R01_lab_results_prev_denv[ , grepl( \"person_id|redcap_event|prev_denv_stfd\" , names(R01_lab_results_prev_denv) ) ]\n\nR01_lab_results<-  merge(R01_lab_results_prev_denv, R01_lab_results, by = c(\"person_id\",\"redcap_event_name\"), all.y = TRUE)\n\nR01_lab_results_prev_chikv<-R01_lab_results[which(R01_lab_results$infected_chikv_stfd==1|R01_lab_results$result_igg_chikv_stfd==1),]\nR01_lab_results_prev_chikv <- R01_lab_results_prev_chikv[order(R01_lab_results_prev_chikv$person_id, R01_lab_results_prev_chikv$int_date),]\nR01_lab_results_prev_chikv <- R01_lab_results_prev_chikv[!duplicated(R01_lab_results_prev_chikv$person_id),]\nR01_lab_results_prev_chikv$prev_chikv_stfd<-1\nR01_lab_results_prev_chikv<-R01_lab_results_prev_chikv[ , grepl( \"person_id|redcap_event|prev_chikv_stfd\" , names(R01_lab_results_prev_chikv) ) ]\nR01_lab_results<-  merge(R01_lab_results_prev_chikv, R01_lab_results, by = c(\"person_id\",\"redcap_event_name\"), all.y = T)\n\nR01_lab_results <- within(R01_lab_results, prev_chikv_stfd[(tested_chikv==1 & is.na(prev_chikv_stfd))|(!is.na(result_igg_chikv_stfd) & is.na(prev_chikv_stfd)) ] <- 0)\nR01_lab_results <- within(R01_lab_results, prev_denv_stfd[(tested_denv==1 & is.na(prev_denv_stfd))|(!is.na(result_igg_denv_stfd) & is.na(prev_denv_stfd)) ] <- 0)\n\ntable(R01_lab_results$prev_chikv_stfd,R01_lab_results$id_cohort)\ntable(R01_lab_results$prev_denv_stfd, R01_lab_results$id_cohort)\n\n# seroprevalence -----------------------------------------------------------------\ntable(R01_lab_results$result_igg_denv_stfd)\n8185  + 222   + 10 \n222/8417*100\ntable(R01_lab_results$result_igg_chikv_stfd)\n9134+  225+   16 \n225/9375*100\n\ntable(R01_lab_results$result_igg_chikv_stfd, R01_lab_results$site, exclude=NULL)\n62/(6024+62+13)*100#chikv seroprevalence coast\n163/(3110+163+3)*100#chikv seroprevalence west\ntable(R01_lab_results$result_igg_denv_stfd, R01_lab_results$site)\n189/(4961+189+9)*100#denv coast\n33/(3224+33+1)*100#denv west\n\ntable(R01_lab_results$result_igg_chikv_stfd, R01_lab_results$rural)\n144/(144+4687+7)*100#chikv rural\n81/(81+9+4447)*100#chikv urban\ntable(R01_lab_results$result_igg_denv_stfd, R01_lab_results$rural)\n150/(1+150+4677)*100#denv rural\n72/(72+9+3508)*100#denv urban\n\ntable(R01_lab_results$result_igg_denv_stfd, R01_lab_results$rural, exclude=NULL)\n\ntable(R01_lab_results$result_igg_chikv_stfd, R01_lab_results$id_cohort)\ntable(R01_lab_results$result_igg_denv_stfd, R01_lab_results$id_cohort)\n\n\n# graphs -----------------------------------------------------------------\n#stanford infected denv aic\n#symptom sum histogram for aic\ninfected_pcr_denv_stfd_igg<-R01_lab_results[which(R01_lab_results$infected_denv_stfd==1),]\ntiff(file = \"AIC DENV Infected (Stanford IgG, all PCR).tiff\", width = 3200, height = 3200, units = \"px\", res = 800)\nhist(infected_pcr_denv_stfd_igg$symptom_sum, breaks=50, main = \"AIC DENV Infected (Stanford IgG, all PCR)\", xlab = \"Number of Symptoms Reported at acute\", freq=TRUE)\ndev.off()\n#cohort\ninfected_pcr_denv_stfd_igg$id_cohort<-substr(infected_pcr_denv_stfd_igg$person_id, 2, 2)\ntable(infected_pcr_denv_stfd_igg$id_cohort , exclude = NULL)\n#symptomatic aic\ntable(R01_lab_results$symptomatic, R01_lab_results$infected_denv_stfd)\n\n\n#kenya infected denv aic\n#symptom sum for aic\ninfected_pcr_denv_stfd_igg<-R01_lab_results[which(R01_lab_results$infected_denv_stfd==1),]\ninfected_pcr_denv_kenya_igg<-R01_lab_results[which(R01_lab_results$infected_denv_kenya==1),]\ntiff(file = \"AIC DENV Infected (Kenya IgG, all PCR).tiff\", width = 3200, height = 3200, units = \"px\", res = 800)\nhist(infected_pcr_denv_kenya_igg$symptom_sum, breaks=50, main = \"AIC DENV Infected (Kenya IgG, all PCR)\", xlab = \"Number of Symptoms Reported at acute\", freq=TRUE)\ndev.off()\n#cohort\ninfected_pcr_denv_kenya_igg$id_cohort<-substr(infected_pcr_denv_kenya_igg$person_id, 2, 2)\ntable(infected_pcr_denv_kenya_igg$id_cohort , exclude = NULL)\n#symptomatic for aic\ntable(R01_lab_results$symptomatic, R01_lab_results$infected_denv_kenya)\n\n#stanford infected chikv aic\n#symptom sum histogram for aic\ninfected_pcr_chikv_stfd_igg<-R01_lab_results[which(R01_lab_results$infected_chikv_stfd==1),]\ntiff(file = \"AIC chikv Infected (Stanford IgG, all PCR).tiff\", width = 3200, height = 3200, units = \"px\", res = 800)\nhist(infected_pcr_chikv_stfd_igg$symptom_sum, breaks=50, main = \"AIC chikv Infected (Stanford IgG, all PCR)\", xlab = \"Number of Symptoms Reported at acute\", freq=TRUE)\ndev.off()\n#cohort\ninfected_pcr_chikv_stfd_igg$id_cohort<-substr(infected_pcr_chikv_stfd_igg$person_id, 2, 2)\ntable(infected_pcr_chikv_stfd_igg$id_cohort , exclude = NULL)\n#symptomatic aic\ntable(R01_lab_results$symptomatic, R01_lab_results$infected_chikv_stfd)\n\n\n#kenya infected chikv aic\n#symptom sum for aic\ninfected_pcr_chikv_kenya_igg<-R01_lab_results[which(R01_lab_results$infected_chikv_kenya==1),]\n\ntiff(file = \"AIC chikv Infected (Kenya IgG, all PCR).tiff\", width = 3200, height = 3200, units = \"px\", res = 800)\nhist(infected_pcr_chikv_kenya_igg$symptom_sum, breaks=50, main = \"AIC chikv Infected (Kenya IgG, all PCR)\", xlab = \"Number of Symptoms Reported at acute\", freq=TRUE)\ndev.off()\n\n#cohort\ninfected_pcr_chikv_kenya_igg$id_cohort<-substr(infected_pcr_chikv_kenya_igg$person_id, 2, 2)\ntable(infected_pcr_chikv_kenya_igg$id_cohort , exclude = NULL)\n#symptomatic for aic\ntable(R01_lab_results$symptomatic, R01_lab_results$infected_chikv_kenya)\n#save file\nsave(R01_lab_results,file=\"R01_lab_results.rda\")\n# survival ---------------------------------------------------------\nlibrary(ggkm)\nR01_lab_results$visit<- as.numeric(as.factor(R01_lab_results$redcap_event))\nR01_lab_results$visit<-R01_lab_results$visit-1\nR01_lab_results <- within(R01_lab_results, visit[visit==8] <- NA)\nR01_lab_results <- within(R01_lab_results, visit[visit==9] <- NA)\ntable(R01_lab_results$visit)  \n\n#extract first event\ntable(R01_lab_results$infected_denv_kenya, R01_lab_results$year, exclude = NULL)\nRanks <- with(R01_lab_results, ave(infected_denv_kenya, person_id, infected_denv_kenya, FUN = function(x) \n  rank(x, ties.method=\"first\")))\ninfected_denv_kenya<-  R01_lab_results[Ranks == 1, ]\n\n#infected_chikv_kenya\ntable(R01_lab_results$infected_chikv_kenya, R01_lab_results$year, exclude = NULL)\nRanks <- with(R01_lab_results, ave(infected_chikv_kenya, person_id, infected_chikv_kenya, FUN = function(x) \n  rank(x, ties.method=\"first\")))\ninfected_chikv_kenya<-  R01_lab_results[Ranks == 1, ]\ntable(infected_chikv_kenya$infected_chikv_kenya,  exclude = NULL)\n\n#infected_denv_stfd\ntable(R01_lab_results$infected_denv_stfd, R01_lab_results$year, exclude = NULL)\nRanks <- with(R01_lab_results, ave(infected_denv_stfd, person_id, infected_denv_stfd, FUN = function(x) \n  rank(x, ties.method=\"first\")))\ninfected_denv_stfd<-  R01_lab_results[Ranks == 1, ]\ntable(infected_denv_stfd$infected_denv_stfd,  exclude = NULL)\n\n#infected_chikv_stfd\nRanks <- with(R01_lab_results, ave(infected_chikv_stfd, person_id, infected_chikv_stfd, FUN = function(x) \n  rank(x, ties.method=\"first\")))\ninfected_chikv_stfd<-  R01_lab_results[Ranks == 1, ]\n\n# tables ---------------------------------------------------------\nlibrary(tableone)\n## Create Table 1 stratified by infection \nR01_lab_results$gender_all = R01_lab_results$gender  # your new merged column start with gender\nR01_lab_results$gender_all[!is.na(R01_lab_results$gender_aic)] = R01_lab_results$gender_aic[!is.na(R01_lab_results$gender_aic)]  # merge with gender_aic\ntable(R01_lab_results$gender_all, exclude = NULL)\n\ncolnames(R01_lab_results)[colnames(R01_lab_results)==\"gender_all\"] <- \"Female\"\ncolnames(R01_lab_results)[colnames(R01_lab_results)==\"id_city\"] <- \"City\"\ncolnames(R01_lab_results)[colnames(R01_lab_results)==\"id_cohort\"] <- \"Cohort\"\n\nR01_lab_results <- within(R01_lab_results, City[R01_lab_results$City==\"G\"] <- \"M\")\nR01_lab_results <- within(R01_lab_results, City[R01_lab_results$City==\"L\"] <- \"M\")\n\nR01_lab_results <- within(R01_lab_results, City[R01_lab_results$City==\"R\"] <- \"C\")\nR01_lab_results <- within(R01_lab_results, City[R01_lab_results$City==\"O\"] <- NA)\ntable(R01_lab_results$City)\n\n\nvars <- c(\"site\", \"City\", \"Cohort\", \"rural\", \"age_group\", \"Female\")\nfactorVars <- c(\"site\", \"City\", \"Cohort\", \"rural\", \"age_group\", \"Female\")\n\ntableOne <- CreateTableOne(vars = vars, factorVars = factorVars, strata = \"prev_denv_stfd\", data = R01_lab_results)\nprint(tableOne, quote = TRUE,\n      exact=c(\"site\", \"City\", \"Cohort\", \"rural\", \"age_group\", \"Female\"))\n\ntableOne <- CreateTableOne(vars = vars, factorVars = factorVars, strata = \"prev_chikv_stfd\", data = R01_lab_results)\nprint(tableOne, quote = TRUE,\n      exact=c(\"site\", \"City\", \"Cohort\", \"rural\", \"Female\"))\n\ntableOne <- CreateTableOne(vars = vars, factorVars = factorVars, strata = \"infected_chikv_stfd\", data = R01_lab_results)\nprint(tableOne, quote = TRUE,\n      exact=c(\"site\", \"City\", \"Cohort\", \"rural\", \"Female\"))\n\ntableOne <- CreateTableOne(vars = vars, factorVars = factorVars, strata = \"infected_denv_stfd\", data = R01_lab_results)\nprint(tableOne, quote = TRUE,\n      exact=c(\"site\", \"City\", \"Cohort\", \"rural\", \"Female\"))\n\n\n# #missing dates export ---------------------------------------------------\nmissing_date<-R01_lab_results[which((R01_lab_results$infected_denv_stfd!=\"\" & is.na(R01_lab_results$year)) | (R01_lab_results$infected_chikv_stfd!=\"\" & is.na(R01_lab_results$year))) , ]\n\n#export to csv\nsetwd(\"C:/Users/amykr/Box Sync/Amy Krystosik's Files/Data Managment/redcap/ro1 lab results long\")\nf <- \"missing_date.csv\"\nwrite.csv(as.data.frame(missing_date), f )\n\n\n\n# #hcc survival with time. ---------------------------------------------------\nhcc<-R01_lab_results[which(R01_lab_results$id_cohort==\"C\" ), ]\nhcc<- within(hcc, rural[rural==1 ] <- \"Rural\")\nhcc<- within(hcc, rural[rural==0 ] <- \"Urban\")\n\nsurv_month_infected_denv_stfd <- survfit(Surv(month_year_numeric, infected_denv_chikv_stfd)~id_city, data=hcc)\nhcc_infected_denv_stfd_survival<-  ggplot(hcc, aes(time = month_year_numeric, status = infected_denv_stfd,  color = factor(rural))) + geom_km()\nhcc_infected_chikv_stfd_survival<-  ggplot(hcc, aes(time = month_year_numeric, status = infected_chikv_stfd,  color = factor(rural))) + geom_km()\nhcc_infected_denv_chikv_stfd_survival<-  ggplot(hcc, aes(time = month_year_numeric, status = infected_denv_chikv_stfd,  color = factor(rural))) + geom_km()\n\n\nhcc_pos<-hcc[which(hcc$infected_denv_chikv_stfd==1 ), ]\ntable(hcc_pos$infected_denv_chikv_stfd, hcc_pos$interview_date)\n\nprint(hcc_infected_denv_chikv_stfd_survival + ggtitle(\"DENV or CHIKV survival by Rural vs Urban (HCC)\")\n      + labs(y=\"Survival\", x = \"Follow-up (days)\")\n      +theme(legend.position=\"bottom\")\n      + theme(legend.title = element_blank())\n      + theme(legend.text = element_text( size=20, face=\"bold\"))\n      + theme(plot.title = element_text( size=40, face=\"bold\"))\n      + theme(axis.title = element_text( size=20, face=\"bold\"))\n      + theme(axis.text = element_text( size=20, face=\"bold\"))\n      +theme(plot.title = element_text(hjust = 0.5))\n)\n\n##plot aic or hcc incident R01_lab_results---------------------------------------------------\nR01_lab_results<- within(R01_lab_results, id_cohort[id_cohort==\"C\" ] <- \"HCC\")\nR01_lab_results<- within(R01_lab_results, id_cohort[id_cohort==\"F\" ] <- \"AIC\")\n\ntable(R01_lab_results$City, exclude=NULL)\n\nmonthly_infection <- ddply(R01_lab_results, .(month_year, City),\n                           summarise, \n                           infected_denv_stfd_sum = sum(infected_denv_stfd, na.rm = TRUE),\n                           infected_chikv_stfd_sum = sum(infected_chikv_stfd, na.rm = TRUE),\n                           infected_denv_stfd_inc = mean(infected_denv_stfd, na.rm = TRUE),\n                           infected_chikv_stfd_inc = mean(infected_chikv_stfd, na.rm = TRUE),\n                           infected_denv_stfd_sd = sd(infected_denv_stfd, na.rm = TRUE),\n                           infected_chikv_stfd_sd = sd(infected_chikv_stfd, na.rm = TRUE)\n)\nage_infection <- ddply(R01_lab_results, .(age_group),\n                       summarise, \n                       infected_denv_stfd_sum = sum(infected_denv_stfd, na.rm = TRUE),\n                       infected_chikv_stfd_sum = sum(infected_chikv_stfd, na.rm = TRUE),\n                       infected_denv_stfd_inc = mean(infected_denv_stfd, na.rm = TRUE),\n                       infected_chikv_stfd_inc = mean(infected_chikv_stfd, na.rm = TRUE),\n                       infected_denv_stfd_sd = sd(infected_denv_stfd, na.rm = TRUE),\n                       infected_chikv_stfd_sd = sd(infected_chikv_stfd, na.rm = TRUE)\n)\n\nR01_lab_results$prev_denv_stfd<-as.numeric(as.character(R01_lab_results$prev_denv_stfd))\n\nage_prev <- ddply(R01_lab_results, .(age_group),\n                  summarise, \n                  infected_denv_stfd_sum = sum(prev_denv_stfd, na.rm = TRUE),\n                  infected_chikv_stfd_sum = sum(prev_chikv_stfd, na.rm = TRUE),\n                  infected_denv_stfd_inc = mean(prev_denv_stfd, na.rm = TRUE),\n                  infected_chikv_stfd_inc = mean(prev_chikv_stfd, na.rm = TRUE),\n                  infected_denv_stfd_sd = sd(prev_denv_stfd, na.rm = TRUE),\n                  infected_chikv_stfd_sd = sd(prev_chikv_stfd, na.rm = TRUE)\n)\n\n\nlibrary(plotly)\nf1 <- list(\n  family = \"Arial, sans-serif\",\n  size = 18,\n  color = \"black\"\n)\nf2 <- list(\n  family = \"Arial, sans-serif\",\n  size = 24,\n  color = \"black\"\n)\nf3 <- list(\n  family = \"Arial, sans-serif\",\n  size = 36,\n  color = \"black\"\n)\na <- list(\n  autotick = FALSE,\n  ticks = \"outside\",\n  tick0 = 0,\n  dtick = 1,\n  ticklen = 5,\n  tickwidth = 2,\n  tickcolor = toRGB(\"black\"),\n  tickfont=f1,\n  title=\"\"\n)\nlegend = list(orientation = \"h\",   # show entries horizontally\n              xanchor = \"center\",  # use center of legend as anchor\n              x = 0.5,\n              font=f2\n)  \nmargin = list(l = 100, r = 50, b = 50, t = 75, pad = 4)\n\ndenv_incidence_time_city<-  plot_ly() %>%\n  add_trace(x=monthly_infection$month_year, y = monthly_infection$infected_denv_stfd_sd+monthly_infection$infected_denv_stfd_inc, name = 'Max', type = 'scatter', mode = 'lines+markers', fill = 'tonexty', fillcolor='rgba(0,100,80,0.2)', line = list(color = 'transparent'), connectgaps=TRUE, showlegend=FALSE, split=monthly_infection$City)%>%\n  add_trace(x=monthly_infection$month_year, y =monthly_infection$infected_denv_stfd_inc, type = 'scatter', mode = 'lines', line=list(width=4), connectgaps=TRUE, showlegend=T, split=monthly_infection$City)%>%\n  layout(title='Incident DENV over Time', \n         titlefont=f3, \n         xaxis = a, \n         yaxis = list(title = 'Proportion infected', tickfont=f1,titlefont=f2, range = c(0,1) ),legend=legend, \n         margin = margin)\n\n\nchikv_incidence_time_city<-  plot_ly() %>%\n  add_trace(x=monthly_infection$month_year, y = monthly_infection$infected_chikv_stfd_sd+monthly_infection$infected_chikv_stfd_inc, name = 'Max', type = 'scatter', mode = 'lines+markers', fill = 'tonexty', fillcolor='rgba(0,100,80,0.2)', line = list(color = 'transparent'), connectgaps=TRUE, showlegend=FALSE, split=monthly_infection$City)%>%\n  add_trace(x=monthly_infection$month_year, y =monthly_infection$infected_chikv_stfd_inc, type = 'scatter', mode = 'lines', line=list(width=4), connectgaps=TRUE, showlegend=T, split=monthly_infection$City)%>%\n  layout(title='Incident CHIKV over Time', \n         titlefont=f3, \n         xaxis = a, \n         yaxis = list(title = 'Proportion infected', tickfont=f1,titlefont=f2,range = c(0,1)),legend=legend, \n         margin = margin)\n\n\n\nage_chikv_incidence<-ggplot() + geom_bar(data = age_infection, aes(age_group, infected_chikv_stfd_inc), stat=\"identity\")+\n  geom_errorbar(data =  age_prev, aes(age_group, infected_chikv_stfd_inc, \n                                      ymin = 0, \n                                      ymax = infected_chikv_stfd_inc + infected_chikv_stfd_sd),\n                width = 0.4)\nage_denv_incidence<-ggplot() + geom_bar(data = age_infection, aes(age_group, infected_denv_stfd_inc), stat=\"identity\")+\n  geom_errorbar(data =  age_prev, aes(age_group, infected_denv_stfd_inc, \n                                      ymin = 0, \n                                      ymax = infected_denv_stfd_inc + infected_denv_stfd_sd),\n                width = 0.4)\n\nage_chikv_prev<-ggplot() + geom_bar(data = age_prev, aes(age_group, infected_chikv_stfd_inc), stat=\"identity\")+\n  geom_errorbar(data =  age_prev, aes(age_group, infected_chikv_stfd_inc, \n                                      ymin = 0, \n                                      ymax = infected_chikv_stfd_inc + infected_chikv_stfd_sd),\n                width = 0.4)\n\nage_denv_prev<-ggplot() + geom_bar(data = age_prev, aes(age_group, infected_denv_stfd_inc), stat=\"identity\")+\n  geom_errorbar(data =  age_prev, aes(age_group, infected_denv_stfd_inc, \n                                      ymin = 0, \n                                      ymax = infected_denv_stfd_inc + infected_denv_stfd_sd),\n                width = 0.4)\n\nprint(age_chikv_incidence \n      + ggtitle(\"CHIKV Incident Exposure by Age\")\n      + labs(y=\"Proportion subjects Exposed\", x = \"\")\n      + theme(legend.position=\"bottom\")\n      + theme(legend.title = element_blank())\n      + theme(legend.text = element_text( size=20, face=\"bold\"))\n      + theme(plot.title = element_text( size=40, face=\"bold\"))\n      + theme(axis.title = element_text( size=20, face=\"bold\"))\n      + theme(axis.text = element_text( size=20, face=\"bold\"))\n      + theme(plot.title = element_text(hjust = 0.5))\n)\n\n\n\n###either denv or chikv incidence---------------------------------------------------\ntable(R01_lab_results$infected_denv_chikv_stfd, R01_lab_results$id_cohort)\ntable(R01_lab_results$infected_denv_chikv_stfd, R01_lab_results$age_group, exclude = NULL)\n\n###either denv or chikv prevalence---------------------------------------------------\nR01_lab_results$prev_denv_chikv_all[R01_lab_results$prev_denv_stfd ==0|R01_lab_results$prev_chikv_stfd==0]<-0\nR01_lab_results$prev_denv_chikv_all[R01_lab_results$prev_denv_stfd ==1|R01_lab_results$prev_chikv_stfd==1]<-1\ntable(R01_lab_results$prev_denv_chikv_all, R01_lab_results$age_group, exclude = NULL)\ntable(R01_lab_results$tested_denv_chikv, R01_lab_results$age_group, exclude = NULL)\n\n####get incidence by age group numberator and denominator ---------------------------------------------------\n#denv\ntable(R01_lab_results$infected_denv_stfd, R01_lab_results$id_cohort, exclude = NULL)\ntable(R01_lab_results$tested_denv, R01_lab_results$id_cohort, exclude = NULL)\ntable(R01_lab_results$infected_denv_stfd, R01_lab_results$age_group, exclude = NULL)\ntable(R01_lab_results$tested_denv, R01_lab_results$age_group, exclude = NULL)\n#chikv\ntable(R01_lab_results$infected_chikv_stfd, R01_lab_results$age_group, exclude = NULL)\ntable(R01_lab_results$tested_chikv, R01_lab_results$id_cohort, exclude = NULL)\ntable(R01_lab_results$infected_chikv_stfd, R01_lab_results$id_cohort, exclude = NULL)\ntable(R01_lab_results$tested_chikv, R01_lab_results$age_group, exclude = NULL)\n#denv or chikv\ntable(R01_lab_results$infected_denv_chikv_stfd, R01_lab_results$age_group, exclude = NULL)\ntable(R01_lab_results$infected_denv_chikv_stfd, R01_lab_results$id_cohort, exclude = NULL)\ntable(R01_lab_results$tested_denv_chikv, R01_lab_results$age_group, exclude = NULL)\n\n\n##get incidence by cohort numberator and denominator---------------------------------------------------\ntable(R01_lab_results$infected_denv_stfd, R01_lab_results$id_cohort)\ntable(R01_lab_results$tested_denv, R01_lab_results$id_cohort)\n\ntable(R01_lab_results$infected_chikv_stfd, R01_lab_results$id_cohort)\ntable(R01_lab_results$tested_chikv, R01_lab_results$id_cohort)\n\ntable(R01_lab_results$infected_denv_chikv_stfd, R01_lab_results$id_cohort, exclude = NULL)\ntable(R01_lab_results$tested_denv_chikv, R01_lab_results$id_cohort, exclude = NULL)\n\n#some need age  to be included in sample\nno_age<-R01_lab_results[which(is.na(R01_lab_results$age_group) & !is.na(R01_lab_results$prev_denv_chikv_all)), ]\nno_age<-no_age[, grepl(\"person_id|redcap_event_name|date|prev_denv_chikv_all\", names(no_age))]\ntable(is.na(R01_lab_results$age_group) & R01_lab_results$prev_denv_chikv_all==1)\nwrite.csv(as.data.frame(no_age), \"no_age.csv\", na=\"\", row.names = F )\n\n#prevalence\ntable(R01_lab_results$prev_chikv_igg_stfd_all_pcr)\n(195/6992)*100#prevalence of chikv.\ntable(R01_lab_results$prev_chikv_igg_stfd_all_pcr, R01_lab_results$site)\n(145/(145+2958))*100#prevalence of chikv west\n(50/(50+3839))*100#prevalence of chikv coast\ntable(R01_lab_results$prev_denv_igg_stfd_all_pcr)\n(268/6748)*100#prevalence of denv.\ntable(R01_lab_results$prev_denv_igg_stfd_all_pcr, R01_lab_results$site)\n(154/(154+3442))*100#prevalence of denv coast\n(114/(114+3038))*100#prevalence of denv west\n\ntable(R01_lab_results$prev_denv_igg_stfd_all_pcr, R01_lab_results$rural)\n(103/(103+3184))*100#prevalence of denv urban\n(165/(165+3296))*100#prevalence of denv rural\n\n\n# meds prescribed ---------------------------------------------------------\n#load(\"R01_lab_results 2018-03-21 .rda\")  \n\nR01_lab_results$malaria_treatment_other_kenya<-gsub(\",\", \"_\", R01_lab_results$malaria_treatment_other_kenya)\nR01_lab_results$all_meds<-NA\nR01_lab_results$all_meds<-paste(R01_lab_results$meds_prescribed, R01_lab_results$malaria_treatment_other_kenya, sep=\"_\")\n\nR01_lab_results$all_meds<-tolower(R01_lab_results$all_meds)\nR01_lab_results$all_meds <- gsub('  ', ' ', R01_lab_results$all_meds)\nR01_lab_results$all_meds <- gsub(' ', '_', R01_lab_results$all_meds)\n\nR01_lab_results$all_meds<-gsub(\"apirin|diclonac|voline_gel|voltaren|dinac|duclofenac|ibeufen|buscopan|painmedi|brufen|painmedi|painmedbrufen|diclo|ibrufen|ibrufeen\", \" painmed \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"plasil|actals|actal\", \" gerd \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"ventolin|ventoli|sabutanol|salbutamol|albutol|salbutanol|butanol\", \" anti_bronchospasm \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"amoxicillin|t.flamox|doxycline|butol|augumrnting|antibacterialardrop|antibacterialflaxin|cefriaxone|antibacterialeardrop|antibacterialfloxaxilin|flaxin|floxaxilin|antibacterialg|amoxyl|amoxl|amixil|erytthromycin|doxy|antibacterialflaxin|aoxil|seotrin|amoxil|penicillin|antibacterialeardrop|antibacterialg|chloramphenicol|teo|t.e.o|flagyl|flaggyl|ciproxin|augumentin|cefxime|ciproxin|chlamphenicol|cefixime|ciproxin|ciprofloxin|intravenous_metronidazole|nitrofurantion|ciprofloxacin|flagyla|gentamicin|metronidazole|floxapen|flucloxacill|trinidazole|vedrox|ampiclox|cloxacillin|ampicillin|albendaxole|albedazole|tinidazole|tetracycline|augmentin|ceftriaxone|penicillian|septrin|antibiotic|ceftrizin|cotrimoxazole|cefuroxime|erythromycin|gentamycin|cipro|antibacterial|septin|amoxxil|antibacteriale\", \" antibacterial \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"guaifenesin|expectants|expectant|tricoff|ossthial|osthial|expen\", \" expectorant \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"syrup|unibrolcoldcap|unibrol|tricohist|trichohist|cold_cap|ascoril\", \" cough \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub( \"cetrizine hydrochloride|chlorepheramine|chlore|hydrocrt|hydrocortisone|cetrizine|pirtion|piriton|priton|hydroctisone_cream|hydroctisone|hydroctione|cpm|pitriton|pirion|pirito|probeta-n|allergy|allergyllergy|hydrocort|promethazon|cezine|cetrizin|cezzzine|benahist|amine|adreline\", \" allergy \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"calaminelotion|calamine|calaminetopical|calamine_lotion|cream|lotion|eye_ointment\", \" topical \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"mulitivit|multivit|multivitamin|zinc_tablet|vitamin|multivit|multivt|zinc|multisupplement|supplement|m/supplements|ranferon|ferrous_sulphate|ferous|folic_acid|folic|ferrous|haemoton|saferon|mulitisupplement|raferon|multvit|mulit|mult|m/vits\", \" supplement \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"paracentamol|paracetamol|ibuprofen|diclofeanc|diclofenac|calpol|plcetantipyretic\", \" antipyretic \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"ketoconazole|griseofulvin|clotrimazole|clotrimazone|grisofluvin|graeofulvin|graseofulvin|greseofulvin|nystatin|nystatin_oral_mouth_paint|antifungaltopical|nestatin|ketaconazole|statin\", \" antifungal \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"ors|o.r.s.\", \" ors \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"i.v.|ivs|i.v.s.|i.v\", \" iv \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"diloxanide\", \" antiamoeba \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"admission|admitted|admit\", \" admit \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"azt\", \" antiviral \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"amitripin\", \" antidepressant \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"predison\", \" immunosuppressant \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"paraziquantel|albendazole|abz|mebendazole|benzimidazole|diloxanide|paraziquatel|fluconazole|bendazole\", \" antihelmenthic \", R01_lab_results$all_meds)\nR01_lab_results$all_meds<-gsub(\"plcet|plct|pct|pcet|irin|coarem|plcet|im_quinine|attesunate|artesunate|artesun|quinine|coartem|coatem|antimalarial|caortem|coarterm|coart|coaterm|coartm|quinnie|atersunate|quinnine|paludrin|quinnie|duocotecxin|pheramine|artsun|atesunate|atesa|artesinate|pcm\", \" antimalarial \", R01_lab_results$all_meds)\n#sp and al are too short to include.\nR01_lab_results$all_meds<-gsub(\"/|none|other|and|eardrop\", \" \", R01_lab_results$all_meds)\n\n# dummy meds vars ---------------------------------------------------------\n#subset meds\nmeds<-R01_lab_results[, c(\"person_id\", \"redcap_event_name\",\"all_meds\", \"meds_prescribed\",\"malaria_treatment_other_kenya\")]\nmeds <- lapply(meds, function(x) {  gsub(\"NA\", \"\", x)})\nmeds <- lapply(meds, function(x) {  gsub(\"na\", \"\", x)})\nmeds <- lapply(meds, function(x) {  gsub(\" \", \"_\", x)})\nmeds <- lapply(meds, function(x) {  gsub(\", \", \"_\", x)})\nmeds <- lapply(meds, function(x) {  gsub(\"__\", \"_\", x)})\nmeds<-as.data.frame(meds)\n#create dummy vars for all meds\nlev <- levels(factor(meds$all_meds))\nlev <- unique(unlist(strsplit(lev, \"_\")))\nmnames <- gsub(\" \", \"_\", paste(\"med\", lev, sep = \"_\"))\nresult <- matrix(data = \"0\", nrow = length(meds$all_meds), ncol = length(lev))\nchar.med <- as.character(meds$all_meds)\nfor (i in 1:length(lev)) {\n  result[grep(lev[i], char.med, fixed = TRUE), i] <- \"1\"\n}\nresult <- data.frame(result, stringsAsFactors = TRUE)\ncolnames(result) <- mnames\nmeds <- cbind(meds,result)\nR01_lab_results<-merge(meds,R01_lab_results,by=c(\"person_id\",\"redcap_event_name\"), all=TRUE)    \n\nsubset( R01_lab_results, med_cal==1, c(all_meds.x,meds_prescribed.x,  malaria_treatment_other_kenya.x,person_id))\nR01_lab_results$malaria_treatment_other_kenya.x\nR01_lab_results <- within(R01_lab_results, med_antimalarial[R01_lab_results$malaria_treatment_kenya___1==1] <- 1)\nR01_lab_results <- within(R01_lab_results, med_antimalarial[R01_lab_results$malaria_treatment_kenya___2==1] <- 1)\nR01_lab_results <- within(R01_lab_results, med_antimalarial[R01_lab_results$malaria_treatment_kenya___3==1] <- 1)\nR01_lab_results <- within(R01_lab_results, med_antimalarial[R01_lab_results$malaria_treatment_kenya___4==1] <- 1)\nR01_lab_results <- within(R01_lab_results, med_antimalarial[R01_lab_results$malaria_treatment_kenya___5==1] <- 1)\ntable(R01_lab_results$med_antimalarial)\n\nR01_lab_results$antiparasite <- NA\nR01_lab_results <- within(R01_lab_results, antiparasite[R01_lab_results$med_antihelmenthic==0|R01_lab_results$med_antimalarial==0] <- 0)\nR01_lab_results <- within(R01_lab_results, antiparasite[R01_lab_results$med_antihelmenthic==1|R01_lab_results$med_antimalarial==1] <- 1)\ntable(R01_lab_results$antiparasite)\n\nlibrary(stringr)\nR01_lab_results$number_meds <- str_count(R01_lab_results$all_meds.x, \"_\")\nR01_lab_results$number_meds<-R01_lab_results$number_meds+1\ntable(R01_lab_results$number_meds)\n\n# save cleaned dataset ----------------------------------------------------\nR01_lab_results$gender_all = R01_lab_results$gender  # your new merged column start with gender\nR01_lab_results$gender_all[!is.na(R01_lab_results$gender_aic)] = R01_lab_results$gender_aic[!is.na(R01_lab_results$gender_aic)]  # merge with gender_aic\ntable(R01_lab_results$gender_all, exclude = NULL)\n\nsetwd(\"C:/Users/amykr/Box Sync/Amy Krystosik's Files/Data Managment/redcap/ro1 lab results long\")\nsave(R01_lab_results,file=\"R01_lab_results.clean.rda\")    #save as r data frame for use in other analysis. \n\n#save(R01_lab_results,file=\"R01_lab_results.david.coinfection.dataset.rda\")    #save as r data frame for use in other analysis. #final data set made on 5/23/18 for david conifection paper.\n\n#Malaria: positive by result_microscopy_malaria_kenya, or if NA, then positive by malaria_result\nR01_lab_results$malaria<-NA\nR01_lab_results <- within(R01_lab_results, malaria[R01_lab_results$result_rdt_malaria_keny==0] <- 0)#rdt\nR01_lab_results <- within(R01_lab_results, malaria[R01_lab_results$rdt_result==0] <- 0)#rdt\nR01_lab_results <- within(R01_lab_results, malaria[R01_lab_results$malaria_results==0] <- 0)# Results of malaria blood smear\t(+++ system)\nR01_lab_results <- within(R01_lab_results, malaria[R01_lab_results$result_microscopy_malaria_kenya==0] <- 0)#microscopy. this goes last so that it overwrites all the other's if it exists.\n\nR01_lab_results <- within(R01_lab_results, malaria[R01_lab_results$result_microscopy_malaria_kenya==1] <- 1) #this goes first. only use the others if this is missing.\nR01_lab_results <- within(R01_lab_results, malaria[R01_lab_results$malaria_results>0 & is.na(result_microscopy_malaria_kenya)] <- 1)# Results of malaria blood smear\t(+++ system)\nR01_lab_results <- within(R01_lab_results, malaria[R01_lab_results$rdt_results==1 & is.na(result_microscopy_malaria_kenya)] <- 1)#rdt\ntable(R01_lab_results$malaria)\n\ntable(R01_lab_results$infected_denv_stfd, R01_lab_results$malaria)\ntable(R01_lab_results$infected_chikv_stfd, R01_lab_results$malaria)\n\ntable(R01_lab_results$infected_denv_chikv_stfd, R01_lab_results$malaria,R01_lab_results$acute)\nR01_lab_results_acute<- R01_lab_results[which(R01_lab_results$acute==1)  , ]\n\n158+219+2153+1948\n(158/4478)*100\ntable(R01_lab_results_acute$infected_denv_chikv_stfd, R01_lab_results_acute$malaria)\n\n161+232+2250+2606\n\n    ",
    "created" : 1528308248567.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1065436954",
    "id" : "233D0097",
    "lastKnownWriteTime" : 1528308288,
    "last_content_update" : 1528308288140,
    "path" : "~/GitHub/lebeaud_lab/R01/redcap/export r01 data from redcap and create binary vars.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}